<html>

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <header>
    </header>

    <head>
        <!-- JS, Popper.js, and jQuery -->
        <script src="https://code.jquery.com/jquery-3.5.1.js"
            integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
        <!-- CSS only -->
        <!-- CSS bootstrap -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css"
            rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <!-- CSS bootstrap datatables  -->
        <link href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css" />
        <!-- CSS bootstrap datatables select  -->
        <link rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
        <!-- CSS bootstrap lines sidebar  -->
        <link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet" />
        <!-- CSS bootstrap sidebar  -->
        <link rel="stylesheet" href="../css/style.css">
        <!-- JS and jQuery -->
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
            integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
            crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
            integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
            crossorigin="anonymous"></script>
        <!--JS datatables  -->
        <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
        <!-- CSS bootstrap select  -->


        <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>


        <!-- Font Awesome -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js"></script>
        <!-- Datepicker -->
        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <!-- Datepicker -->
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <!-- Datatables -->
        <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
        <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
        <script type="text/javascript"
            src="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.10.20/b-1.6.1/b-flash-1.6.1/b-html5-1.6.1/b-print-1.6.1/r-2.2.3/datatables.min.js">
            </script>
        <!-- Momentjs -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>

        <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
        <script type="text/javascript"
            src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
        <link rel="stylesheet" type="text/css"
            href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
        <link href="assets/css/xcharts.min.css" rel="stylesheet">

        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>


        <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>-->

        <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>


             <!-- Buttons -->
  <link
  href="https://cdn.datatables.net/buttons/2.0.1/css/buttons.dataTables.min.css"
  rel="stylesheet"
  type="text/css"
/>
<script src="https://cdn.datatables.net/buttons/2.0.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.html5.min.js"></script>
  <!-- Select2 plugin -->
  <link
    rel="stylesheet"
    type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css"
  />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>

    </head>

    <%- include("partials/sidebar_top") %>
        <!-- Main Component -->

        <div class="main">

            <nav class="navbar navbar-expand">
                <button class="toggler-btn" type="button">
                    <i class="lni lni-text-align-left"></i>
                </button>
            </nav>
            <main class="p-3">
                <div class="container-fluid">
                    <h1 class="text-center text-primary mt-2 mb-2"></h1>
                    <div class="card">

                        <div class="row">
                            <div class="col-md-12">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="input-group mb-3">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text bg-info text-white" id="basic-addon1"><i
                                                        class="fas fa-calendar-alt"></i></span>
                                            </div>
                                            <input type="text" class="form-control" id="start_date"
                                                placeholder="Start Date" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="input-group mb-3">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text bg-info text-white" id="basic-addon1"><i
                                                        class="fas fa-calendar-alt"></i></span>
                                            </div>
                                            <input type="text" class="form-control" id="end_date" placeholder="End Date"
                                                readonly>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <button id="filter" class="btn btn-outline-info btn-sm">Filter</button>
                                    <button id="reset" class="btn btn-outline-warning btn-sm">Reset

                                    </button>
                                    <button class="btn btn-outline-warning btn-sm">


                                        <select class="nieve" name="nieve">
                                            <option value="">type â€¦</option>
                                            <option value="line">Line</option>
                                            <option value="pie">Pie</option>
                                            <option value="radar">Radar</option>
                                            <option value="polarArea">Polar Area</option>
                                        </select>

                                        <div class="resultado"></div>

                                    </button>
                                </div>
                                <br>
                                <div class="row">
                                    <div class="col-md-8 mt-5">
                                        <div class="chart-container">
                                            <canvas id="scoreChart" height="200" width="500"></canvas>

                                        </div>

                                    </div>
                                </div>
                                </br>
                                <div class="card">

                                    <div class="row">


                                        <div class="col-lg-3">
                                            <select name="column_name" id="column_name"
                                                class="form-control selectpicker"
                                                data-none-selected-text="Ocultar Columna..." data-live-search="true"
                                                multiple>
                                                <option value="0">Estado</option>
                                                <option value="1">Descripcion_del_CI</option>
                                                <option value="2">id_del_ci</option>
                                                <option value="3">Piso</option>
                                                <option value="4">ID_de_inicio_de_sesion</option>
                                                <option value="5">telefono</option>
                                                <option value="6">usuario</option>
                                                <option value="7">Nombre_Completo</option>
                                            </select>

                                        </div>

                                    </div>

                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table id="example" class="table table-bordered table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>Estado</th>
                                                        <th>Descripcion_del_CI</th>
                                                        <th>id_del_ci</th>
                                                        <th>Piso</th>
                                                        <th>ID_de_inicio_de_sesion</th>
                                                        <th>telefono</th>
                                                        <th>usuario</th>
                                                        <th>Nombre_Completo</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive">

                        </div>

                    </div>


                    <div class="chart-container" style="position: relative; width:80vw">
                        <canvas id="my_Chart"></canvas>
                    </div>

                    <div class="chart-container" style="position: relative; width:80vw">
                        <canvas id="my_Chart"></canvas>
                    </div>


                </div>
        </div>
        <br />

        <br />
        </div>
        </main>
        </div>
        </div>

        <script src="../scripts/script.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
        </body>


</html>

<script>



    $(function () {
        $("#start_date").datepicker({
            "dateFormat": "yy-mm-dd"
        });
        $("#end_date").datepicker({
            "dateFormat": "yy-mm-dd"
        });
    });

    // Filter

    $(document).on("click", "#filter", function (e) {
        e.preventDefault();

        var start_date = $("#start_date").val();
        var end_date = $("#end_date").val();

        if (start_date == "" || end_date == "") {
            alert("both date required");

        }
        else {
            $('#example').DataTable().destroy();

            async function postData() {
                try {
                    const response = await fetch('http://localhost:3000/picker', {
                        'searching': true,
                        method: 'POST',
                        body: JSON.stringify({
                            "start_date": $("#start_date").val(),
                            "end_date": $("#end_date").val()
                        }

                        ),
                        headers: {
                            'Content-Type': 'application/json',
                        },

                    })

                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {

                            // console.log(data)
                            const datos = [data];
                            datos.forEach(value => {
                                //console.log(value)

                                const id = data.map(item => item.id);
                                const name = data.map(item => item.name);
                                const created_at = data.map(item => item.created_at);
                                const percentage = data.map(item => item.percentage);
                                const result = data.map(item => item.result);
                                const standard = data.map(item => item.standard);

 

                                var myData = {
                                    labels: created_at,
                                    datasets: [{
                                        label: "Hey, baby!",
                                        fill: false,
                                        backgroundColor: [
                                            'rgba(255,92,0)',
                                            'rgba(0,128,0)',
                                            'rgba(15,82,186)',
                                            'rgba(255,237,41)',
                                            'rgba(54, 162, 235, 0.2)',
                                            'rgba(153, 102, 255, 0.2)',
                                            'rgba(201, 203, 207, 0.2)',
                                            'rgba(255, 99, 132, 0.2)',
                                            'rgba(255, 159, 64, 0.2)',
                                            'rgba(255, 205, 86, 0.2)',
                                            'rgba(75, 192, 192, 0.2)',
                                            'rgba(54, 162, 235, 0.2)',
                                            'rgba(153, 102, 255, 0.2)',
                                            'rgba(201, 203, 207, 0.2)',
                                            'rgba(255, 99, 132, 0.2)',
                                            'rgba(255, 159, 64, 0.2)',
                                            'rgba(255, 205, 86, 0.2)',
                                            'rgba(75, 192, 192, 0.2)',
                                            'rgba(54, 162, 235, 0.2)',
                                            'rgba(153, 102, 255, 0.2)',
                                            'rgba(201, 203, 207, 0.2)',
                                            'rgba(255, 99, 132, 0.2)',
                                            'rgba(255, 159, 64, 0.2)',
                                            'rgba(255, 205, 86, 0.2)',
                                            'rgba(75, 192, 192, 0.2)',
                                            'rgba(54, 162, 235, 0.2)',
                                            'rgba(153, 102, 255, 0.2)',
                                            'rgba(201, 203, 207, 0.2)',
                                        ],
                                        borderColor: [
                                            'rgb(255, 99, 132)',
                                            'rgb(255, 159, 64)',
                                            'rgb(255, 205, 86)',
                                            'rgb(75, 192, 192)',
                                            'rgb(54, 162, 235)',
                                            'rgb(153, 102, 255)',
                                            'rgb(201, 203, 207)',
                                            'rgb(255, 99, 132)',
                                            'rgb(255, 159, 64)',
                                            'rgb(255, 205, 86)',
                                            'rgb(75, 192, 192)',
                                            'rgb(54, 162, 235)',
                                            'rgb(153, 102, 255)',
                                            'rgb(201, 203, 207)'


                                        ],

                                        borderColor: 'black',
                                        data: percentage,

                                    }],
                                    options: {
                                        scales: {
                                            y: {
                                                beginAtZero: true
                                            }
                                        }
                                    }
                                };

 
                                myChart2.destroy();
                                var ctx = document.getElementById('scoreChart').getContext('2d');
                                var myChart = new Chart(ctx, {
                                    type: 'bar',    	// Define chart type
                                    data: myData    	// Chart data
                                });

                                // Function runs on chart type select update

                                const selectElement = document.querySelector(".nieve");
                                const resultado = document.querySelector(".resultado");

                                selectElement.addEventListener("change", (event) => {
                                    myChart.destroy();

                                    myChart = new Chart(ctx, {
                                        type: event.target.value,  // Select chart type from dropdown
                                        data: myData,

                                    });



                                });

                            })


                        })


                }

                catch (error) {

                }

            }

            postData()
            $(document).ready(function () {
                new DataTable('#example', {
                    dom: "Bfrtlip",
               buttons: [
        'copy', 'excel', 'csv'
    ],
                    lengthMenu: [5, 10, 15, 20, 100, 200, 500],
                    columnDefs: [
                        {
                            targets: 1,

                        },
                        { className: "noVis", targets: [0, 1, 2, 3, 4, 5] },
                        { orderable: false, targets: [5] },
                        { searchable: false, targets: [1] }


                
                    ],
                    layout: {
                        topStart: {
                            buttons: [
                                {
                                    extend: 'colvis',
                                    columns: ':not(.noVis)',
                                    popoverTitle: 'Column visibility selector'
                                }
                            ]
                        }
                    },

                    "oLanguage": {

                        "sSearch": "Busqueda Rapida:"

                    },
                    language: {
                        lengthMenu: 'Mostrar _MENU_ Filas'
                    },
                    "processing": true,

                    "order": [],
                    'ajax': {
                        url: 'http://localhost:3000/api/intervals/' + $("#start_date").val() + '&' + $("#end_date").val(),
                        type: "get"
                    },
                    'order': [],
                    columns: [
                        { data: 'id' },
                        { data: 'name' },
                        { data: 'created_at' },
                        { data: 'result' },
                        {
                            data: 'percentage',
                            render: function (data, type) {
                                var number = DataTable.render
                                    .number(',', '.', 2, '$')
                                    .display(data);

                                if (type === 'display') {
                                    let color = 'orange';
                                    if (data < 50) {
                                        color = 'red';
                                    }
                                    else if (data > 50) {
                                        color = 'green';
                                    }

                                    return `<span style="color:${color}">${number}</span>`;
                                }

                                return number;
                            }
                        },
                        { data: 'standard' }
                    ]


                });

                $('#column_name').selectpicker({
                    noneSelectedText: 'Please Select' // by this default 'Nothing selected' -->will change to Please Select
                });

                $('#column_name').change(function () {
                    var all_column = ["0", "1", "2", "3", "4", "5", "6", "7"];
                    var remove_column = $('#column_name').val();
                    var remaining_column = all_column.filter(function (obj) { return remove_column.indexOf(obj) == -1; });
                    dataTable.columns(remove_column).visible(false);
                    dataTable.columns(remaining_column).visible(true);

                });


            });


        }
    });

    // Reset

    $(document).on("click", "#reset", function (e) {
        e.preventDefault();

        $("#start_date").val(''); // empty value
        $("#end_date").val('');

        location.reload();
       

    });


</script>

<script>

    // Data define for bar chart
    var myData2 = {
        labels: ["Javascript", "Java", "Python", "PHP", "C++", "TypeScript", "Linux Shell", "C", "Ruby on Rails"],
        datasets: [{
            label: "Hey, baby!",
            fill: false,
            backgroundColor: ['#ff0000', '#ff4000', '#ff8000', '#ffbf00', '#ffbf00', '#ffff00', '#bfff00', '#80ff00', '#40ff00', '#00ff00'],
            borderColor: 'black',
            data: [85, 60, 70, 50, 18, 20, 45, 30, 20],
        }]
    };


    var ctx = document.getElementById('scoreChart').getContext('2d');
    var myChart2 = new Chart(ctx, {
        type: 'bar',    	// Define chart type
        data: myData2    	// Chart data
    });

    new DataTable('#example', {
        dom: "Bfrtlip",
               buttons: [
        'copy', 'excel', 'csv'
    ],
        ajax: {
            url: 'http://localhost:3000/student',
            dataSrc: ''
        },
        columns: [
            { data: 'id' },
            { data: 'name' },
            { data: 'standard' },
            { data: 'percentage' },
            { data: 'result' },
            { data: 'created_at' }
        ]
    });


</script>